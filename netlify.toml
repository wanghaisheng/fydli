#
# Basic configuration
# Modify as required/desired.
#

# Change as required
[build]
  # After this, remove base and uncomment command and publish below
  command = "npm run build"
  publish = "site"

  # Defining non-sensitive environment variables here is possible e.g
  [build.environment]
    # BLOCK_DOMAINS = 'fyd.li,localhost,example.com'
    # PUBLIC_SITE = "true"
    # MAIN_PAGE = "makeitshort"
    # SHORT_URL_LENGTH = 5
    # SHORT_URL_CHARS = "1234567890abcdefABCDEF"
    # SITE_TITLE = "FYDLI"

# Using `import` so need `esbuild`
[functions]
  node_bundler = "esbuild"

  [functions."rebuild-redirects"]
    # Other options are @hourly, @daily, @monthly, @yearly
    # As scheduled functions are new, there is the possibility these options
    # will change.
    # See: https://github.com/netlify/labs/tree/main/features/scheduled-functions/documentation
    schedule = "@weekly"

# Local testing
[dev]
  # Would prefer if false was the default!
  autoLaunch = false
  # When site isn't linked, this is handy.
  offline = true

#
# Headers
#
# Customise headers as required.
#
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    Content-Security-Policy = "base-uri 'self'; script-src 'self' 'nonce-9fe3abc61d7a'; style-src 'self' 'nonce-9fe3abc61d7a'; img-src 'self'; object-src 'self'; frame-ancestors 'none'"
    # Disable refer(r)er
    Referrer-Policy = "no-referrer"
    # Removal of Clear-Site-Data to enable Local Storage
    # Clear-Site-Data = '"*"'
    X-Robots-Tag = "noindex, nofollow, noarchive, nosnippet, notranslate"

#
# REMEMBER:
# `_redirects` is processed first, followed by `redirects` in netlify.toml
# No redirects are "forced", so if a path exists that is equal to that of a
# redirect, the path content is served.
# 

# Functions rewrite.
[[redirects]]
  from = "/app/*"
  to = "/.netlify/functions/:splat"
  status = 200

# ########################################################################### #
#                                                                             #
#                    DO NOT PUT ANY REDIRECTS BELOW HERE!                     #
#                                                                             #
# ########################################################################### #

# This is the fallback so capture any
# path that doesn't exist in `_redirects`
[[redirects]]
  from = "/*"
  to = "/.netlify/functions/redir"
  status = 200

# When site isn't public if you do not wish to utilise this `redir` function,
# other options are to create a 404.html replacing the above redirect with e.g.
# [[redirects]]
#   from = "/*"
#   to = "/404"
#   status = 404
#
# Or have everything else redirect to your main site e.g.
# [[redirects]]
#   from = "/*"
#   to = "https://example.com/?utm_source=shortener&utm_medium=invalid-link"
#   status = 301
